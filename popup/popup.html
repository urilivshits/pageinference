<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		    <title>Browse Buddy: Iuliia's Lil Helper</title>
		<link rel="stylesheet" href="styles/popup.css" />
		<link rel="stylesheet" href="../lib/highlight.min.css" />
		<script src="../lib/highlight.min.js"></script>
		<script src="../lib/markdown-it.min.js"></script>
		<style>
			/* Add auto-execute highlight styling */
			.auto-execute {
				background-color: rgba(76, 175, 80, 0.1) !important;
				border-color: #4caf50 !important;
				transition: background-color 0.8s, border-color 0.8s !important;
			}

			.auto-execute-notice {
				background-color: #4caf50;
				color: white;
				padding: 8px;
				text-align: center;
				font-weight: bold;
				border-radius: 4px;
				margin: 8px 0;
				animation: fadeIn 0.3s ease;
			}

			@keyframes fadeIn {
				from {
					opacity: 0;
				}
				to {
					opacity: 1;
				}
			}
		</style>
	</head>
	<body data-theme="light">
		<div id="double-click-area" title="Double-click to run last query"></div>
		<div class="popup-container">
			<!-- Sidebar for chat navigation -->
			<aside class="sidebar">
				<button id="sidebar-new-chat" class="sidebar-new-chat">
					<span class="sidebar-new-chat-icon" aria-hidden="true" style="display: inline-flex; align-items: center; justify-content: center; margin-right: 8px">
						<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
							<circle cx="12" cy="12" r="10" />
							<line x1="12" y1="8" x2="12" y2="16" />
							<line x1="8" y1="12" x2="16" y2="12" />
						</svg>
					</span>
					New Chat
				</button>
				<div class="sidebar-search-container">
					<input id="sidebar-search-input" type="text" placeholder="Search chats..." />
					<div style="margin-top: 8px; display: flex; align-items: center; gap: 8px">
						<input type="checkbox" id="sidebar-domain-filter-toggle" style="margin: 0" />
						<label for="sidebar-domain-filter-toggle" id="sidebar-domain-filter-label" style="cursor: pointer; user-select: none; white-space: nowrap"
							>Only show chats from this site</label
						>
					</div>
				</div>
				<ul id="sidebar-sessions-list" class="sidebar-sessions-list"></ul>
				<div id="sidebar-no-sessions-message" class="sidebar-no-sessions-message">No chat sessions found</div>
			</aside>
			<!-- Main content area -->
			<div class="main-content">
				<!-- Header with profile -->
				<header class="popup-header">
					<div class="header-left">
						<img src="../icons/default_icon48.png" alt="Profile" class="profile-avatar" />
						            <h1 class="header-title">Browse Buddy: Iuliia's Lil Helper</h1>
					</div>
					<div class="header-right">
						<button id="settings-gear-button" class="settings-gear-button" title="Settings">
							<svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
								<circle cx="12" cy="12" r="3"></circle>
								<path d="M12 1v6m0 6v6m11-7h-6m-6 0H1m15.5-3.5L19 6.5M5 18.5L6.5 17M18.5 17L17 18.5M6.5 6.5L5 5"></path>
							</svg>
						</button>
					</div>
				</header>
				<div id="chat-container" class="tab-container active" data-tab="chat">
					<div id="chat-messages" class="chat-messages">
						<!-- Enhanced SVG Flower Animation -->
						<svg id="popup-flower-animation" width="280" height="280" viewBox="0 0 280 280" xmlns="http://www.w3.org/2000/svg">
							<!-- Outer petals layer -->
							<g class="flower-petals-outer">
								<!-- Outer petal 1 -->
								<ellipse
									cx="140"
									cy="55"
									rx="20"
									ry="35"
									fill="var(--flower-petal-color, #b94fc6)"
									stroke="var(--flower-petal-stroke, #7a2e8a)"
									stroke-width="1.5"
									opacity="0.85"
									transform="rotate(0 140 140)"
								/>
								<!-- Outer petal 2 -->
								<ellipse
									cx="140"
									cy="55"
									rx="20"
									ry="35"
									fill="var(--flower-petal-color, #b94fc6)"
									stroke="var(--flower-petal-stroke, #7a2e8a)"
									stroke-width="1.5"
									opacity="0.85"
									transform="rotate(30 140 140)"
								/>
								<!-- Outer petal 3 -->
								<ellipse
									cx="140"
									cy="55"
									rx="20"
									ry="35"
									fill="var(--flower-petal-color, #b94fc6)"
									stroke="var(--flower-petal-stroke, #7a2e8a)"
									stroke-width="1.5"
									opacity="0.85"
									transform="rotate(60 140 140)"
								/>
								<!-- Outer petal 4 -->
								<ellipse
									cx="140"
									cy="55"
									rx="20"
									ry="35"
									fill="var(--flower-petal-color, #b94fc6)"
									stroke="var(--flower-petal-stroke, #7a2e8a)"
									stroke-width="1.5"
									opacity="0.85"
									transform="rotate(90 140 140)"
								/>
								<!-- Outer petal 5 -->
								<ellipse
									cx="140"
									cy="55"
									rx="20"
									ry="35"
									fill="var(--flower-petal-color, #b94fc6)"
									stroke="var(--flower-petal-stroke, #7a2e8a)"
									stroke-width="1.5"
									opacity="0.85"
									transform="rotate(120 140 140)"
								/>
								<!-- Outer petal 6 -->
								<ellipse
									cx="140"
									cy="55"
									rx="20"
									ry="35"
									fill="var(--flower-petal-color, #b94fc6)"
									stroke="var(--flower-petal-stroke, #7a2e8a)"
									stroke-width="1.5"
									opacity="0.85"
									transform="rotate(150 140 140)"
								/>
								<!-- Outer petal 7 -->
								<ellipse
									cx="140"
									cy="55"
									rx="20"
									ry="35"
									fill="var(--flower-petal-color, #b94fc6)"
									stroke="var(--flower-petal-stroke, #7a2e8a)"
									stroke-width="1.5"
									opacity="0.85"
									transform="rotate(180 140 140)"
								/>
								<!-- Outer petal 8 -->
								<ellipse
									cx="140"
									cy="55"
									rx="20"
									ry="35"
									fill="var(--flower-petal-color, #b94fc6)"
									stroke="var(--flower-petal-stroke, #7a2e8a)"
									stroke-width="1.5"
									opacity="0.85"
									transform="rotate(210 140 140)"
								/>
								<!-- Outer petal 9 -->
								<ellipse
									cx="140"
									cy="55"
									rx="20"
									ry="35"
									fill="var(--flower-petal-color, #b94fc6)"
									stroke="var(--flower-petal-stroke, #7a2e8a)"
									stroke-width="1.5"
									opacity="0.85"
									transform="rotate(240 140 140)"
								/>
								<!-- Outer petal 10 -->
								<ellipse
									cx="140"
									cy="55"
									rx="20"
									ry="35"
									fill="var(--flower-petal-color, #b94fc6)"
									stroke="var(--flower-petal-stroke, #7a2e8a)"
									stroke-width="1.5"
									opacity="0.85"
									transform="rotate(270 140 140)"
								/>
								<!-- Outer petal 11 -->
								<ellipse
									cx="140"
									cy="55"
									rx="20"
									ry="35"
									fill="var(--flower-petal-color, #b94fc6)"
									stroke="var(--flower-petal-stroke, #7a2e8a)"
									stroke-width="1.5"
									opacity="0.85"
									transform="rotate(300 140 140)"
								/>
								<!-- Outer petal 12 -->
								<ellipse
									cx="140"
									cy="55"
									rx="20"
									ry="35"
									fill="var(--flower-petal-color, #b94fc6)"
									stroke="var(--flower-petal-stroke, #7a2e8a)"
									stroke-width="1.5"
									opacity="0.85"
									transform="rotate(330 140 140)"
								/>
							</g>

							<!-- Inner petals layer -->
							<g class="flower-petals-inner">
								<!-- Inner petal 1 -->
								<ellipse
									cx="140"
									cy="75"
									rx="16"
									ry="28"
									fill="var(--flower-petal-color, #b94fc6)"
									stroke="var(--flower-petal-stroke, #7a2e8a)"
									stroke-width="1.5"
									opacity="0.95"
									transform="rotate(15 140 140)"
								/>
								<!-- Inner petal 2 -->
								<ellipse
									cx="140"
									cy="75"
									rx="16"
									ry="28"
									fill="var(--flower-petal-color, #b94fc6)"
									stroke="var(--flower-petal-stroke, #7a2e8a)"
									stroke-width="1.5"
									opacity="0.95"
									transform="rotate(45 140 140)"
								/>
								<!-- Inner petal 3 -->
								<ellipse
									cx="140"
									cy="75"
									rx="16"
									ry="28"
									fill="var(--flower-petal-color, #b94fc6)"
									stroke="var(--flower-petal-stroke, #7a2e8a)"
									stroke-width="1.5"
									opacity="0.95"
									transform="rotate(75 140 140)"
								/>
								<!-- Inner petal 4 -->
								<ellipse
									cx="140"
									cy="75"
									rx="16"
									ry="28"
									fill="var(--flower-petal-color, #b94fc6)"
									stroke="var(--flower-petal-stroke, #7a2e8a)"
									stroke-width="1.5"
									opacity="0.95"
									transform="rotate(105 140 140)"
								/>
								<!-- Inner petal 5 -->
								<ellipse
									cx="140"
									cy="75"
									rx="16"
									ry="28"
									fill="var(--flower-petal-color, #b94fc6)"
									stroke="var(--flower-petal-stroke, #7a2e8a)"
									stroke-width="1.5"
									opacity="0.95"
									transform="rotate(135 140 140)"
								/>
								<!-- Inner petal 6 -->
								<ellipse
									cx="140"
									cy="75"
									rx="16"
									ry="28"
									fill="var(--flower-petal-color, #b94fc6)"
									stroke="var(--flower-petal-stroke, #7a2e8a)"
									stroke-width="1.5"
									opacity="0.95"
									transform="rotate(165 140 140)"
								/>
								<!-- Inner petal 7 -->
								<ellipse
									cx="140"
									cy="75"
									rx="16"
									ry="28"
									fill="var(--flower-petal-color, #b94fc6)"
									stroke="var(--flower-petal-stroke, #7a2e8a)"
									stroke-width="1.5"
									opacity="0.95"
									transform="rotate(195 140 140)"
								/>
								<!-- Inner petal 8 -->
								<ellipse
									cx="140"
									cy="75"
									rx="16"
									ry="28"
									fill="var(--flower-petal-color, #b94fc6)"
									stroke="var(--flower-petal-stroke, #7a2e8a)"
									stroke-width="1.5"
									opacity="0.95"
									transform="rotate(225 140 140)"
								/>
								<!-- Inner petal 9 -->
								<ellipse
									cx="140"
									cy="75"
									rx="16"
									ry="28"
									fill="var(--flower-petal-color, #b94fc6)"
									stroke="var(--flower-petal-stroke, #7a2e8a)"
									stroke-width="1.5"
									opacity="0.95"
									transform="rotate(255 140 140)"
								/>
								<!-- Inner petal 10 -->
								<ellipse
									cx="140"
									cy="75"
									rx="16"
									ry="28"
									fill="var(--flower-petal-color, #b94fc6)"
									stroke="var(--flower-petal-stroke, #7a2e8a)"
									stroke-width="1.5"
									opacity="0.95"
									transform="rotate(285 140 140)"
								/>
								<!-- Inner petal 11 -->
								<ellipse
									cx="140"
									cy="75"
									rx="16"
									ry="28"
									fill="var(--flower-petal-color, #b94fc6)"
									stroke="var(--flower-petal-stroke, #7a2e8a)"
									stroke-width="1.5"
									opacity="0.95"
									transform="rotate(315 140 140)"
								/>
								<!-- Inner petal 12 -->
								<ellipse
									cx="140"
									cy="75"
									rx="16"
									ry="28"
									fill="var(--flower-petal-color, #b94fc6)"
									stroke="var(--flower-petal-stroke, #7a2e8a)"
									stroke-width="1.5"
									opacity="0.95"
									transform="rotate(345 140 140)"
								/>
							</g>

							<!-- Flower center with gradient -->
							<defs>
								<radialGradient id="centerGradient" cx="50%" cy="50%" r="50%">
									<stop offset="0%" style="stop-color:var(--flower-center-color, #f7b731);stop-opacity:1" />
									<stop offset="100%" style="stop-color:var(--flower-center-stroke, #f39c12);stop-opacity:1" />
								</radialGradient>
							</defs>
							<circle cx="140" cy="140" r="18" fill="url(#centerGradient)" stroke="var(--flower-center-stroke, #f39c12)" stroke-width="2" />

							<!-- Flower stem -->
							<rect x="136" y="158" width="8" height="80" fill="var(--flower-stem-color, #3a7d3b)" rx="4" />

							<!-- Enhanced leaves -->
							<ellipse cx="120" cy="190" rx="16" ry="10" fill="var(--flower-stem-color, #3a7d3b)" transform="rotate(-25 120 190)" opacity="0.9" />
							<ellipse cx="160" cy="210" rx="16" ry="10" fill="var(--flower-stem-color, #3a7d3b)" transform="rotate(25 160 210)" opacity="0.9" />
							<ellipse cx="115" cy="220" rx="14" ry="8" fill="var(--flower-stem-color, #3a7d3b)" transform="rotate(-35 115 220)" opacity="0.85" />
							<ellipse cx="165" cy="185" rx="14" ry="8" fill="var(--flower-stem-color, #3a7d3b)" transform="rotate(35 165 185)" opacity="0.85" />
						</svg>
					</div>
					<div id="loading-indicator" class="loading-indicator hidden">
						<div class="spinner"></div>
						<span>AI is thinking...</span>
					</div>
					<div id="error-message" class="error-message hidden"></div>
					<div class="chat-input-container">
						<div class="chat-input-main">
							<textarea id="message-input" placeholder="Ask a question..." rows="1"></textarea>
							<button id="send-button" class="send-button">
								<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
									<path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
								</svg>
							</button>
						</div>
					</div>
				</div>
				<!-- Settings floating panel (hidden by default) -->
				<div id="settings-panel" class="settings-panel hidden">
					<!-- Settings header with close button -->
					<header class="settings-header">
						<div class="settings-header-left">
							<img src="../icons/default_icon48.png" alt="Profile" class="profile-avatar" />
							<h1 class="settings-title">Settings</h1>
						</div>
						<div class="settings-header-right">
							<button id="settings-close-button" class="settings-close-button" title="Close Settings">
								<svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
									<line x1="18" y1="6" x2="6" y2="18"></line>
									<line x1="6" y1="6" x2="18" y2="18"></line>
								</svg>
							</button>
						</div>
					</header>
					<div id="settings-container" class="settings-container">
						<div class="settings-section">
							<h2>API Key</h2>
							<div class="setting-item">
								<div class="api-key-input-container">
									<input id="api-key-input" type="password" placeholder="sk-..." />
									<button id="toggle-api-key-button" class="icon-button small" title="Show/Hide API Key">
										<span class="icon-eye">
											<svg
												viewBox="0 0 24 24"
												width="20"
												height="20"
												fill="none"
												stroke="currentColor"
												stroke-width="2"
												stroke-linecap="round"
												stroke-linejoin="round"
											>
												<path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z" />
												<circle cx="12" cy="12" r="3" />
											</svg>
										</span>
										<span class="icon-eye-off" style="display: none">
											<svg
												viewBox="0 0 24 24"
												width="20"
												height="20"
												fill="none"
												stroke="currentColor"
												stroke-width="2"
												stroke-linecap="round"
												stroke-linejoin="round"
											>
												<path d="M17.94 17.94A10.94 10.94 0 0 1 12 19c-7 0-11-7-11-7a21.81 21.81 0 0 1 5.06-6.06M1 1l22 22" />
												<path d="M9.53 9.53A3 3 0 0 0 12 15a3 3 0 0 0 2.47-5.47" />
											</svg>
										</span>
									</button>
								</div>
								<p class="setting-description">
									Stored locally only. 
									<a href="https://platform.openai.com/api-keys" target="_blank" rel="noopener noreferrer">Get API key →</a>
								</p>
							</div>
						</div>

						<div class="settings-section">
							<h2>Behavior</h2>
							<div class="setting-item">
								<label for="repeat-message-trigger">Repeat Last Message Trigger:</label>
								<select id="repeat-message-trigger">
									<option value="manual">Normal click → Just open, Ctrl+click → Auto-execute</option>
									<option value="auto">Normal click → Auto-execute, Ctrl+click → Just open</option>
									<option value="disabled">Never auto-execute (always just open)</option>
								</select>
								<p class="setting-description">
									<strong>Manual</strong>: Ctrl+click to repeat. <strong>Auto</strong>: Normal click repeats.
								</p>
							</div>
						</div>

						<div class="settings-section">
							<h2>Chat Settings</h2>
							<div class="setting-item">
								<label for="model-selector">AI Model:</label>
								<select id="model-selector">
									<option value="gpt-4.1-nano">GPT-4.1 nano (Default)</option>
									                <option value="gpt-4.1">GPT-4.1</option>
								</select>
							</div>
							<div class="setting-item">
								<label for="temperature-slider">Temperature: <span id="temperature-value">0.5</span></label>
								<input type="range" id="temperature-slider" min="0" max="1" step="0.1" value="0.5" />
								<p class="setting-description">
									Lower values (0.0-0.3) for focused answers, higher (0.7-1.0) for creative responses.
								</p>
							</div>
							<!-- Web search and page scraping toggles hidden but defaults maintained -->
							<div class="setting-item" style="display: none">
								<label for="web-search-toggle"> <input type="checkbox" id="web-search-toggle" /> Enable Web Search </label>
								<p class="setting-description">Allow the AI to search the web for current information when needed.</p>
							</div>
							<div class="setting-item" style="display: none">
								<label for="page-scraping-toggle"> <input type="checkbox" id="page-scraping-toggle" /> Enable Page Content Analysis </label>
								<p class="setting-description">Include page content in AI analysis for context-aware responses.</p>
							</div>
						</div>

						<div class="settings-section">
							<h2>Theme</h2>
							<div class="setting-item">
								<div class="theme-options">
									<label><input type="radio" name="theme" value="light" /> Light</label>
									<label><input type="radio" name="theme" value="dark" /> Dark</label>
									<label><input type="radio" name="theme" value="system" /> System</label>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script type="module" src="popup.js"></script>
	</body>
</html>
